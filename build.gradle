apply plugin: 'java'

repositories {
    jcenter()
}

dependencies {
    runtime 'org.antlr:antlr4:4.7.2'
}

task generateLexer(type:JavaExec) {
  def lexerName = "InterpreterLexer"
  inputs.file("$ANTLR_SRC/interpreter.g4")
  outputs.file("$GEN_JS_SRC/${lexerName}.js")
  outputs.file("$GEN_JS_SRC/${lexerName}.interp")
  outputs.file("$GEN_JS_SRC/${lexerName}.tokens")
  main = 'org.antlr.v4.Tool'
  classpath = sourceSets.main.runtimeClasspath
  args = ['-Dlanguage=JavaScript', "interpreter.g4", '-o', "../../$GEN_JS_SRC"]
  workingDir = ANTLR_SRC   
}

task generateParser(type:JavaExec) {
  dependsOn generateLexer
  def lexerName = "InterpreterLexer"
  def parserName = "InterpreterParser"
  inputs.file("$ANTLR_SRC/interpreter.g4")
  inputs.file("$GEN_JS_SRC/${lexerName}.tokens")
  outputs.file("$GEN_JS_SRC/${parserName}.js")
  outputs.file("$GEN_JS_SRC/${parserName}.interp")
  outputs.file("$GEN_JS_SRC/${parserName}.tokens")
  main = 'org.antlr.v4.Tool'
  classpath = sourceSets.main.runtimeClasspath
  args = ['-Dlanguage=JavaScript', "interpreter.g4", '-no-listener', '-no-visitor', '-o', "../../$GEN_JS_SRC"]
  workingDir = ANTLR_SRC
}
